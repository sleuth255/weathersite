extends layout
block append content
   body()
     script(type='text/javascript')
       |  zoom = 0;
       |  var timeactive = 0;
       |  var weathertile = 0;
       |  var handle, handle2;
       |  window.onload = setupRefresh;
       |  function setupRefresh()
       |  {
       |    setInterval("refreshRadar();",60*1000);
       |    setInterval("refreshTiles();",60*1000);
       |    setInterval("refreshSunTile();",1*1000);
       if(((skyconditions[0].skyconditions > 4 && day) || (day && rainStormRate > 0)) && changebackgroundto != 1)
          |$('body').css('background', 'url("/images/cloudybackground.jpg") no-repeat bottom fixed');
          |$('body').css('background-size', 'cover');
          |$('.fontcolor').css('color','#ffffff');
       else if(((skyconditions[0].skyconditions > 4 && !day) || (!day && rainStormRate > 0)) && changebackgroundto != 2)
          |$('body').css('background', 'url("/images/cloudynightbackground.jpg") no-repeat bottom fixed');
          |$('body').css('background-size', 'cover');
          |$('.fontcolor').css('color','#ffffff');
       else if(day && changebackgroundto != 3)
          |$('body').css('background', 'url("/images/sunnybackground.jpg") no-repeat bottom fixed');
          |$('body').css('background-size', 'cover');
          |$('.fontcolor').css('color','#000000');
       else if (changebackgroundto != 4)
          |$('body').css('background', 'url("/images/starrybackground.jpg") no-repeat bottom fixed');
          |$('body').css('background-size', 'cover');
          |$('.fontcolor').css('color','#ffffff');
       |  }
       |  function refreshTiles()
       |  {
       |     $('#floatingtiles').load("./tileconditions");
       |  }
       |  function refreshSunTile()
       |  {
       |     $('#suntile').load("./refreshsuntile");
       |  }
       |  function refreshRadar()
       |  {
       |     $('#radarblock').load("./radarrefresh");
       |  }
       |  function getURL(){
       |     var url = location.href;
       |     var idx = url.indexOf('?')
       |     if (idx !== -1)
       |        url = url.substring(0,idx);
       |     idx = url.lastIndexOf('/');
       |     url = url.substring(0,idx);
       |     return url;
       |  }
       |  function conditions(){
       |     window.location = getURL()+"/";
       |  }
       |  function charts(){
       |     window.location = getURL()+"/charts";
       |  }
       |  function uparrowclicked(){
       |     if (zoom == 0){
       |        $(".uparrow").attr('src','/images/UpArrowTransparentRed.png')
       |        setTimeout(function(){$(".uparrow").attr('src','/images/UpArrowTransparent.png');},350)
       |        return
       |     }
       |     $(".radartile").css('background-image', 'url("#{zoominradarimage}")')
       |     $(".uparrow").attr('src','/images/UpArrowTransparentGreen.png')
       |     setTimeout(function(){$(".uparrow").attr('src','/images/UpArrowTransparent.png');},350)
       |     zoom = 0;
       |  }
       |  function downarrowclicked(){
       |     if (zoom == 1){
       |        $(".downarrow").attr('src','/images/DownArrowTransparentRed.png')
       |        setTimeout(function(){$(".downarrow").attr('src','/images/DownArrowTransparent.png');},350)
       |        return
       |     }
       |     $(".radartile").css('background-image', 'url("#{zoomoutradarimage}")')
       |     $(".downarrow").attr('src','/images/DownArrowTransparentGreen.png')
       |     setTimeout(function(){$(".downarrow").attr('src','/images/DownArrowTransparent.png');},350)
       |     zoom = 1;
       |  }
       |  function timetoggle(){
       |     if (timeactive == 1){
       |	   timeactive = 0;
       |       $('.floatingsuntile').show();
       |       $('.floatingtimetile').hide();
       |     }
       |     else{
       |	   timeactive = 1;
       |       clearTimeout(handle);
       |       $('.floatingsuntile').hide();
       |       $('.floatingtimetile').show();
       |       handle = setTimeout(function(){
       |	      timeactive = 0;
       |          $('.floatingsuntile').show();
       |          $('.floatingtimetile').hide();
       |       },60*1000)
       |     }
       |  }
       | function nextWeatherTile(){
       |       clearTimeout(handle2);
       |       weathertile++;
       |       if (weathertile > 3)
       |          weathertile = 0;
       |	   if (weathertile == 0){
       |          $('.floatingweathertile0').show();
       |          $('.floatingweathertile1').hide();
       |          $('.floatingweathertile2').hide();
       |          $('.floatingweathertile3').hide();
       |       }
       |       else
       |	   if (weathertile == 1){
       |          $('.floatingweathertile1').show();
       |          $('.floatingweathertile0').hide();
       |          $('.floatingweathertile2').hide();
       |          $('.floatingweathertile3').hide();
       |       }
       |       else
       |	   if (weathertile == 2){
       |          $('.floatingweathertile2').show();
       |          $('.floatingweathertile1').hide();
       |          $('.floatingweathertile0').hide();
       |          $('.floatingweathertile3').hide();
       |       }
       |       else
       |	   if (weathertile == 3){
       |          $('.floatingweathertile3').show();
       |          $('.floatingweathertile1').hide();
       |          $('.floatingweathertile2').hide();
       |          $('.floatingweathertile0').hide();
       |       }
       |       handle2 = setTimeout(function(){
       |	      weathertile = 0;
       |          $('.floatingweathertile0').show();
       |          $('.floatingweathertile1').hide();
       |          $('.floatingweathertile2').hide();
       |          $('.floatingweathertile3').hide();
       |       },5*1000)
       |}
     div#radarblock(style='display: block; height: 700px;')
        table(cellspacing=0,cellpadding=0,style='width: 85%')
          tr
            td(width="650px",height=550)
             div.radartile(style='display: block; left: 20px; top: 20px; background-image: url("#{zoominradarimage}");')
             img.uparrow(src='/images/UpArrowTransparent.png', onclick='uparrowclicked()')
             img.downarrow(src='/images/DownArrowTransparent.png', onclick='downarrowclicked()')
            td(style='text-align: center')
             img(src='/images/weathersitelogo.png')
     div#suntile
       div.floatingsuntile(onClick='timetoggle()')
        table(cellspacing = 0,cellpadding=0, style='width: 150px')
          tr
           td(height=6)
          tr
           td(style='text-align: center')
             span.smallerbold.fontcolorblack
                |Sunrise/Sunset
          tr
           td(height=6)
          tr
           td(style='text-align: center')
             span.smaller.fontcolorblack
                |#{moment(sunrise).format('h:mm a')} 
          tr
           td(height=70)
          tr
           td(style='text-align: center')
             span.smaller.fontcolorblack
                |#{moment(sunset).format('h:mm a')}
       div.floatingtimetile(style = 'display: none;' onClick='timetoggle()')
        table(cellspacing = 0,cellpadding=0, style='width: 150px')
          tr
           td(height=6)
          tr
           td(style='text-align: center')
             span.smallerbold.fontcolorblack
                |#{moment(new Date()).format('MMM Do, YYYY')}
          tr
           td(height=35)
          tr
           td(style='text-align: center')
             span.bigger.fontcolorblack
                |#{moment(new Date()).format('h:mm:ss')}
          tr
           td(height=25)
          tr
           td(style='text-align: center')
             span.smaller.fontcolorblack
                |#{moment(new Date()).format('dddd')}
     div#floatingtiles
       div.floatingmoontile(style='	background: black url("/images/moon#{moonsize}.gif") no-repeat center 40px;background-size: 50%;')
        table(cellspacing = 0,cellpadding=0, style='width: 150px')
          tr
           td(height=6)
          tr
           td(style='text-align: center')
             span.smallerbold.fontcolorwhite
                |Moon Phase
          tr
           td(height=100)
          tr
           td(style='text-align: center')
             span.smaller.fontcolorwhite
                if (moonsize == 0)
                   |New Moon
                else if (moonsize == 1)
                   |Waxing Crescent
                else if (moonsize == 2)
                   |First Quarter
                else if (moonsize == 3)
                   |Waxing Gibbous
                else if (moonsize == 4)
                   |Full Moon
                else if (moonsize == 5)
                   |Waning Gibbous
                else if (moonsize == 6)
                   |Third Quarter
                else if (moonsize == 7)
                   |Waning Crescent
                else
                   |New Moon
       - condition = skyconditions[0].skyconditions
       - weather = ''
       - hoursout = ["Current Weather","24hr Forecast","48hr Forecast","72hr Forecast"]
       if condition < 5
          - style = 'background: url("/images/DayIcons/skyconditions'+condition+'.png") no-repeat center 35px;background-size: 100%;border: 3px Solid black;background-color: #ffffff;'
       else
          - style = 'background: url("/images/DayIcons/skyconditions'+condition+'.png") no-repeat center 35px;background-size: 100%;border: 3px Solid black;background-color: #b3b3b3;'
       each x in [0,1,2,3]
          - weather = skyconditions[x].weather
          - condition = skyconditions[x].skyconditions
          if x > 0
             if condition < 5
                - style = 'display: none; background: url("/images/DayIcons/skyconditions'+condition+'.png") no-repeat center 35px;background-size: 100%;border: 3px Solid black;background-color: #ffffff;'
             else
                - style = 'display: none; background: url("/images/DayIcons/skyconditions'+condition+'.png") no-repeat center 35px;background-size: 100%;border: 3px Solid black;background-color: #b3b3b3;'
          |<div class=floatingweathertile#{x} style='#{style}' onclick='nextWeatherTile()'>
          table(cellspacing = 0,cellpadding=0, style='width: 150px')
             tr
              td(height=6)
             tr
              td(style='text-align: center')
                span.smallerbold.fontcolorblack
                   |#{hoursout[x]}
             tr
              td(height=100)
             tr
              td(style='text-align: center')
                span.smaller.fontcolorblack
                   |#{weather}
          |</div>
     div#buttons
        button.button(onClick='conditions()') Conditions
        button.button2(onClick='charts()') history           